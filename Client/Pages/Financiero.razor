@page "/Financiero"
@using Empresa.Shared.Model

<h3>Financiero</h3>

<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h4 class="card-title mb-0">Detalles del Préstamo</h4>
        </div>
        <div class="card-body">
            <EditForm Model="prestamo" OnValidSubmit="CalcularPrestamo">
                <div class="mb-3">
                    <label for="concepto" class="form-label">Concepto:</label>
                    <InputText id="concepto" class="form-control" @bind-Value="prestamo.Concepto" />
                </div>
                <div class="mb-3">
                    <label for="monto" class="form-label">Monto:</label>
                    <InputNumber id="monto" class="form-control" @bind-Value="prestamo.MontoPrestamo" />
                </div>
                <div class="mb-3">
                    <label for="interes" class="form-label">Interés (%):</label>
                    <InputNumber id="interes" class="form-control" @bind-Value="prestamo.TasaInteres" />
                </div>
                <div class="mb-3">
                    <label for="meses" class="form-label">Meses:</label>
                    <InputNumber id="meses" class="form-control" @bind-Value="prestamo.PlazoMeses" />
                </div>
                <button type="submit" class="btn btn-primary w-100">
                    <i class="bi bi-calculator"></i> Calcular
                </button>
            </EditForm>
        </div>
    </div>

    @if (resultadoCalculado)
    {
        <div class="card shadow-sm mt-4">
            <div class="card-header bg-success text-white">
                <h4 class="card-title mb-0">Resultados del Préstamo</h4>
            </div>
            <div class="card-body">
                <p><strong>Pago Mensual:</strong> $@pagoMensual.ToString("F2")</p>
            </div>
        </div>
    }
</div>

@code {
    private GastoFinanciero prestamo = new GastoFinanciero
        {
            Concepto = "Préstamo Bancario BHD",
            MontoPrestamo = 100000,
            TasaInteres = 5,
            PlazoMeses = 24
        };

    private decimal pagoTotal;
    private decimal pagoMensual;
    private bool resultadoCalculado = false;

    private void CalcularPrestamo()
    {
        decimal tasaInteresMensual = (decimal)(prestamo.TasaInteres / 100) / 12;
        int numeroPagos = prestamo.PlazoMeses;

        if (tasaInteresMensual == 0)
        {
            pagoMensual = (decimal)prestamo.MontoPrestamo / numeroPagos;
        }
        else
        {
            pagoMensual = (decimal)prestamo.MontoPrestamo * tasaInteresMensual / (1 - (decimal)Math.Pow((double)(1 + tasaInteresMensual), -numeroPagos));
        }

        pagoTotal = pagoMensual * numeroPagos;
        resultadoCalculado = true;
    }
}
